PONER EN CADA VENTATA PHP ESTO:

window.addEventListener('beforeunload', function (event) {
    // Enviar una solicitud AJAX al servidor para actualizar el estado del usuario al cerrar la sesión
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'actualizar_estado_usuario.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.send();
});


<?php
session_start();

if (isset($_SESSION['LastLoggedInUser']) && isset($_SESSION['BaseDatos'])) {

    try {
        // Establecer la conexión PDO
        $dsn = "mysql:host=127.0.0.1;dbname=".$_SESSION['BaseDatos'].";charset=utf8";
        $username = "root";
        $password = "1234";
        $pdo = new PDO($dsn, $username, $password);
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        // Actualizar el estado del usuario en la tabla 'usuario'
        $updateQuery = "UPDATE usuario SET EstadoUsuario = 0 WHERE nombreUsuario = ?";
        $statement = $pdo->prepare($updateQuery);
        $statement->bindParam(1, $_SESSION['LastLoggedInUser'], PDO::PARAM_STR);
        $statement->execute();

        // Cerrar la conexión PDO
        $pdo = null;
    } catch (PDOException $e) {
        echo "Error: " . $e->getMessage();
    }
}
?>
